<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vapor Lock Bookmark Builder</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="settings-section">
        <h3>Settings</h3>
        <div class="settings-columns">
            <div class="settings-column">
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" id="singleSignature" name="signatureMode" value="single" checked>
                        <label for="singleSignature">Single Signature</label>
                    </div>
                    <div class="radio-option">
                        <input type="radio" id="allSignatures" name="signatureMode" value="all">
                        <label for="allSignatures">All Signatures</label>
                    </div>
                    <div class="checkbox-option">
                        <input type="checkbox" id="includeCosmicSignatures">
                        <label for="includeCosmicSignatures">Include Cosmic Signatures</label>
                    </div>
                </div>
            </div>
            <div class="settings-column">
                <div class="checkbox-option" style="margin-left: 0; margin-bottom: 15px;">
                    <input type="checkbox" id="darkModeToggle">
                    <label for="darkModeToggle">Dark Mode</label>
                </div>
                <div class="checkbox-option" style="margin-left: 0; margin-bottom: 15px;">
                    <input type="checkbox" id="grandmaModeToggle">
                    <label for="grandmaModeToggle">Grandma Mode</label>
                </div>
            </div>
        </div>
    </div>

    <div class="form-group">
        <label for="currentHole">Current Hole:</label>
        <select id="currentHole">
            <option value="*" selected>Home (J113508)</option>
        </select>
    </div>

    <div id="nextHoleGroup" class="form-group form-group-inline">
        <div>
            <label for="nextHole">Next Hole:</label>
            <select id="nextHole">
                <option value="">Select...</option>
            </select>
        </div>
        <button id="makeCurrentButton" class="action-button" onclick="makeCurrentFromNext()">Make Current</button>
    </div>

    <div id="currentDepthGroup" class="form-group">
        <label for="currentDepth">Current Depth:</label>
        <div style="display: flex; gap: 10px; flex-wrap: wrap; align-items: center;">
            <div id="depthContainer" style="display: flex; gap: 10px; flex-wrap: wrap;">
                <select id="currentDepth" class="depth-field">
                </select>
            </div>
            <button id="addDepthButton" class="action-button" onclick="addDepth()">+</button>
            <button id="removeDepthButton" class="remove-button" onclick="removeDepth()">-</button>
        </div>
    </div>

    <div class="output-container">
        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
            Temporary Name:
            <div class="output-string" id="temporaryNameCurrent" style="flex: 1;" onclick="copyToClipboard('temporaryNameCurrent')"></div>
            <button id="copyTemporaryNameCurrent" class="copy-button" onclick="copyToClipboard('temporaryNameCurrent')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
            </button>
        </div>
    </div>

    <div id="nextDepthGroup" class="form-group form-group-inline">
        <div>
            <label for="nextDepth">Next Depth:</label>
            <select id="nextDepth">
            </select>
        </div>
        <button class="action-button" onclick="goToNext()">+</button>
        <button class="remove-button" onclick="resetDepth()">Reset</button>
    </div>

    <div class="output-container" id="temporaryNameNextContainer">
        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
            Temporary Name:
            <div class="output-string" id="temporaryNameNext" style="flex: 1;" onclick="copyToClipboard('temporaryNameNext')"></div>
            <button id="copyTemporaryNameNext" class="copy-button" onclick="copyToClipboard('temporaryNameNext')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
            </button>
        </div>
    </div>

    <div class="form-group" id="signatureGroup">
        <label for="signature">Signature:</label>
        <input type="text" id="signature" maxlength="3" placeholder="First 3 letters of cosmic signature...">
    </div>

    <div class="form-group" id="signaturesGroup" style="display: none;">
        <label for="signatures">Signatures:</label>
        <textarea id="signatures" rows="5" placeholder="Enter signatures..."></textarea>
    </div>

    <div class="form-group" id="wormholeTypeGroup">
        <label for="code">Wormhole Type:</label>
        <select id="code">
            <option value="">Select...</option>
            <option value="C1">C1</option>
            <option value="C2">C2</option>
            <option value="C3">C3</option>
            <option value="C4">C4</option>
            <option value="C5">C5</option>
            <option value="C6">C6</option>
            <option value="C13">C13</option>
            <option value="HS">HS</option>
            <option value="LS">LS</option>
            <option value="NS">NS</option>
            <option value="TC">TC</option>
            <option value="??">Unknown</option>
        </select>
    </div>

    <div class="output-container" id="bookmarkSection">
        <div style="display: flex; gap: 10px; align-items: center; flex-wrap: wrap;">
            Bookmark:
            <div class="output-string" id="output" style="flex: 1;" onclick="copyToClipboard('output')"></div>
            <button id="copyButton" class="copy-button" onclick="copyToClipboard('output')">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
            </button>
        </div>
    </div>

    <div class="lists-container" id="listsContainer">
        <div class="bookmarks-column">
            <h3>Bookmarks</h3>
            <div id="bookmarksList" class="bookmarks-list">
                <!-- Dynamic bookmark items will be added here -->
            </div>
        </div>
        <div class="temp-names-column">
            <h3>Temporary Names</h3>
            <div id="tempNamesList" class="temp-names-list">
                <!-- Dynamic temporary name items will be added here -->
            </div>
        </div>
    </div>

    <div class="copied-message" id="copiedMessage">Copied!</div>

    <script>
        // NATO Alphabet
        const natoAlphabet = [
            'Alpha', 'Bravo', 'Charlie', 'Delta', 'Echo', 'Foxtrot',
            'Golf', 'Hotel', 'India', 'Juliett', 'Kilo', 'Lima',
            'Mike', 'November', 'Oscar', 'Papa', 'Quebec', 'Romeo',
            'Sierra', 'Tango', 'Uniform', 'Victor', 'Whiskey', 'X-ray',
            'Yankee', 'Zulu'
        ];

        const natoAlphabetGrandMode = natoAlphabet.map(name => name === 'Golf' ? 'Grandma' : name);

        const isHome = () => document.getElementById('currentHole').value === '*';

        // Function to populate hole dropdowns
        function populateHoleDropdowns() {
            const grandmaMode = document.getElementById('grandmaModeToggle').checked;
            const currentHoleSelect = document.getElementById('currentHole');
            const nextHoleSelect = document.getElementById('nextHole');

            // Save current selections
            const currentHoleValue = currentHoleSelect.value;
            const nextHoleValue = nextHoleSelect.value;

            // Clear existing options (except Home for currentHole)
            currentHoleSelect.innerHTML = '<option value="*" selected>Home (J113508)</option>';
            nextHoleSelect.innerHTML = '<option value="">Select...</option>';

            // Populate dropdowns
            (grandmaMode ? natoAlphabetGrandMode : natoAlphabet).forEach(function(name) {

                // Add to Current Hole dropdown
                const currentOption = document.createElement('option');
                currentOption.value = name;
                currentOption.textContent = name;
                if (name === 'Charlie') {
                    currentOption.disabled = true;
                }
                currentHoleSelect.appendChild(currentOption);

                // Add to Next Hole dropdown
                const nextOption = document.createElement('option');
                nextOption.value = name;
                nextOption.textContent = name;
                if (name === 'Charlie') {
                    nextOption.disabled = true;
                }
                nextHoleSelect.appendChild(nextOption);
            });

            // Restore previous selections
            if (currentHoleValue) {
                if (grandmaMode && currentHoleValue === 'Golf') {
                    currentHoleSelect.value = 'Grandma';
                } else if (!grandmaMode && currentHoleValue === 'Grandma') {
                    currentHoleSelect.value = 'Golf';
                } else {
                    currentHoleSelect.value = currentHoleValue;
                }
            }
            if (nextHoleValue) {
                if (grandmaMode && nextHoleValue === 'Golf') {
                    nextHoleSelect.value = 'Grandma';
                    updateTemporaryNameCurrent();
                } else if (!grandmaMode && nextHoleValue === 'Grandma') {
                    nextHoleSelect.value = 'Golf';  
                    updateTemporaryNameCurrent();
                } else {
                    nextHoleSelect.value = nextHoleValue;
                }
            }
        }

        // Function to populate depth dropdown based on current hole
        function populateDepthDropdown() {
            const numberSelect = document.getElementById('currentDepth');
            const currentValue = numberSelect.value;

            // Clear existing options
            numberSelect.innerHTML = '';

            if (isHome()) {
                // For Home, only show 0
                const option = document.createElement('option');
                option.value = '0';
                option.textContent = '0';
                numberSelect.appendChild(option);
                numberSelect.value = '0';
            } else {
                // For other holes, show 1-100 and default to 1
                for (let i = 0; i <= 100; i++) {
                    const option = document.createElement('option');
                    option.value = i;
                    option.textContent = i;
                    numberSelect.appendChild(option);
                }
                // If current value was 0 or invalid, set to 1
                if (!currentValue) {
                    numberSelect.value = '1';
                } else {
                    numberSelect.value = currentValue;
                }
            }

            // Update button states based on new depth value
            updateRemoveDepthButton();
        }

        // Function to populate next depth dropdown (1-100)
        function populateNextDepthDropdown() {
            const nextDepthSelect = document.getElementById('nextDepth');

            // Populate 0-100
            for (let i = 1; i <= 100; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                nextDepthSelect.appendChild(option);
            }
            // Default to 1
            nextDepthSelect.value = '1';
        }

        // Initial population (default to Home)
        populateDepthDropdown(true);
        populateNextDepthDropdown();
        updateRemoveDepthButton();

        // Handle signature mode toggle
        function toggleSignatureMode() {
            const mode = document.querySelector('input[name="signatureMode"]:checked').value;
            const signatureGroup = document.getElementById('signatureGroup');
            const signaturesGroup = document.getElementById('signaturesGroup');
            const bookmarkSection = document.getElementById('bookmarkSection');
            const listsContainer = document.getElementById('listsContainer');
            const nextDepthGroup = document.getElementById('nextDepthGroup');
            const temporaryNameNextContainer = document.getElementById('temporaryNameNextContainer');
            const wormholeTypeGroup = document.getElementById('wormholeTypeGroup');
            const includeCosmicCheckbox = document.getElementById('includeCosmicSignatures').parentElement;

            if (mode === 'single') {
                signatureGroup.style.display = 'block';
                signaturesGroup.style.display = 'none';
                bookmarkSection.style.display = 'block';
                listsContainer.classList.remove('active');
                wormholeTypeGroup.style.display = 'block';
                includeCosmicCheckbox.style.display = 'none';
                // Show next depth only if not at Home - will be controlled by generateString()
                if (!isHome()) {
                    nextDepthGroup.style.display = 'flex';
                    temporaryNameNextContainer.style.display = 'block';
                }
            } else {
                signatureGroup.style.display = 'none';
                signaturesGroup.style.display = 'block';
                bookmarkSection.style.display = 'none';
                listsContainer.classList.add('active');
                wormholeTypeGroup.style.display = 'none';
                includeCosmicCheckbox.style.display = 'flex';
                // Hide next depth section in all signatures mode
                nextDepthGroup.style.display = 'none';
                temporaryNameNextContainer.style.display = 'none';
            }
        }

        // Add event listeners for radio buttons
        document.getElementById('singleSignature').addEventListener('change', function() {
            toggleSignatureMode();
            saveSettings();
        });
        document.getElementById('allSignatures').addEventListener('change', function() {
            toggleSignatureMode();
            saveSettings();
        });

        // Add event listener for cosmic signatures checkbox
        document.getElementById('includeCosmicSignatures').addEventListener('change', function() {
            generateBookmarksFromSignatures();
            saveSettings();
        });

        // Dark mode toggle functionality
        const darkModeToggle = document.getElementById('darkModeToggle');

        // Load dark mode preference from localStorage
        const isDarkMode = () => localStorage.getItem('darkMode') === 'true';
        if (isDarkMode()) {
            document.body.classList.add('dark-mode');
            darkModeToggle.checked = true;
        }

        // Add event listener for dark mode toggle
        darkModeToggle.addEventListener('change', function() {
            if (this.checked) {
                document.body.classList.add('dark-mode');
                localStorage.setItem('darkMode', 'true');
            } else {
                document.body.classList.remove('dark-mode');
                localStorage.setItem('darkMode', 'false');
            }
            saveSettings();
        });

        // Grandma mode toggle functionality
        const grandmaModeToggle = document.getElementById('grandmaModeToggle');

        // Add event listener for grandma mode toggle
        grandmaModeToggle.addEventListener('change', function() {
            populateHoleDropdowns();
            saveSettings();
        });

        document.getElementById('signature').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^a-zA-Z]/g, '');
            generateString();
        });

        document.getElementById('signatures').addEventListener('input', function(e) {
            generateBookmarksFromSignatures();
        });

        document.getElementById('currentHole').addEventListener('change', function() {
            generateString();
            generateBookmarksFromSignatures();
        });

        document.getElementById('nextHole').addEventListener('change', function() {
            const currentHole = document.getElementById('currentHole').value;
            const nextHole = document.getElementById('nextHole').value;
            const codeSelect = document.getElementById('code');
            document.getElementById('signature').value = '';
            document.getElementById('code').value = '';

            // Auto-select C3 when Current Hole is Home and Next Hole is Alpha
            if (isHome() && nextHole === 'Alpha') {
                codeSelect.value = 'C3';
            }

            // Auto-select C5 when Current Hole is Home and Next Hole is Bravo
            if (isHome() && nextHole === 'Bravo') {
                codeSelect.value = 'C5';
            }

            generateString();
            generateBookmarksFromSignatures();
        });

        document.getElementById('currentDepth').addEventListener('change', function() {
            updateRemoveDepthButton();
            generateString();
            generateBookmarksFromSignatures();
        });

        document.getElementById('nextDepth').addEventListener('change', function() {
            generateString();
            generateBookmarksFromSignatures();
        });

        document.getElementById('code').addEventListener('change', function() {
            generateString();
            generateBookmarksFromSignatures();
        });

        function updateTemporaryNameCurrent() {
            const currentHole = document.getElementById('currentHole').value;
            const currentDepth = document.getElementById('currentDepth').value;
            const nextHole = document.getElementById('nextHole').value;

            if (isHome()) {
                document.getElementById('temporaryNameCurrent').textContent = `${nextHole.toUpperCase() || ' '}`;
            } else {
                if (currentDepth === '0') {
                    document.getElementById('temporaryNameCurrent').textContent = `${currentHole.toUpperCase()}`;
                } else {
                    const currentHoleLetter = currentHole ? currentHole.charAt(0) : '';
                    const depthString = getAllDepths().join('');
                    document.getElementById('temporaryNameCurrent').textContent = `${currentHoleLetter}${depthString === currentHole.toUpperCase() ? '' : depthString}`;
                }
            }
        }

        function generateString() {
            const currentHole = document.getElementById('currentHole').value;
            const currentDepth = document.getElementById('currentDepth').value;
            const nextDepth = document.getElementById('nextDepth').value;
            const nextHole = document.getElementById('nextHole').value;
            const signature = document.getElementById('signature').value;
            const codeSelect = document.getElementById('code');
            const code = codeSelect.value;

            // Check signature mode
            const mode = document.querySelector('input[name="signatureMode"]:checked').value;
            const isAllSignaturesMode = mode === 'all';

            // Show/hide fields based on Current Hole
            const nextHoleGroup = document.getElementById('nextHoleGroup');
            const currentDepthGroup = document.getElementById('currentDepthGroup');
            const nextDepthGroup = document.getElementById('nextDepthGroup');
            const temporaryNameNextContainer = document.getElementById('temporaryNameNextContainer');

            if (isHome()) {
                nextHoleGroup.style.display = 'flex';
                currentDepthGroup.style.display = 'none';
                nextDepthGroup.style.display = 'none';
                temporaryNameNextContainer.style.display = 'none';
            } else {
                nextHoleGroup.style.display = 'none';
                currentDepthGroup.style.display = 'block';
                // Only show next depth section if in single signature mode
                if (isAllSignaturesMode) {
                    nextDepthGroup.style.display = 'none';
                    temporaryNameNextContainer.style.display = 'none';
                } else {
                    nextDepthGroup.style.display = 'flex';
                    temporaryNameNextContainer.style.display = 'block';
                }
            }

            updateTemporaryNameCurrent();

            // Enable/disable Make Current button based on Next Hole selection
            const makeCurrentButton = document.getElementById('makeCurrentButton');
            makeCurrentButton.disabled = !nextHole;

            // Update depth dropdown based on current hole
            populateDepthDropdown();

            // Update UI based on validation
            const outputBox = document.getElementById('output');
            const copyButton = document.getElementById('copyButton');

            let isBookmarkValid = false;
            if (isHome()) {
                // For Home, require nextHole, signature, and code
                isBookmarkValid = nextHole && signature && code && signature.length === 3;
            } else {
                // For other holes, require currentHole, signature, and code
                isBookmarkValid = currentHole && signature && code && signature.length === 3;
            }

            if (isBookmarkValid) {
                outputBox.classList.remove('invalid');
                outputBox.classList.add('valid');
                copyButton.disabled = false;
            } else {
                outputBox.classList.remove('valid');
                outputBox.classList.add('invalid');
            }

            let result;

            // If current hole is Home, just use next hole's name
            if (isHome()) {
                result = ` ${nextHole || ''} ${signature} ${code}`.toUpperCase();
            } else {
                // Get first letter of current hole
                const currentHoleLetter = currentHole ? currentHole.charAt(0) : '';
                const depthString = getAllDepths().join('');

                // Build the string: space + current hole letter + depths + next depth + space + signature + space + code
                result = ` ${currentHoleLetter}${depthString === '0' ? '' : depthString}-${nextDepth} ${signature} ${code}`.toUpperCase();

                document.getElementById('temporaryNameNext').textContent = `${currentHoleLetter}${depthString === '0' ? '' : depthString}${nextDepth}`;
            }

            // Update output
            document.getElementById('output').textContent = result;
        }

        function generateBookmarksFromSignatures() {
            const signaturesText = document.getElementById('signatures').value;
            const currentHole = document.getElementById('currentHole').value;
            const currentDepth = document.getElementById('currentDepth').value;
            const nextDepth = document.getElementById('nextDepth').value;
            const nextHole = document.getElementById('nextHole').value;
            const code = document.getElementById('code').value;

            // Clear existing bookmarks
            clearBookmarks();

            // Parse signatures line by line and collect them
            const lines = signaturesText.split('\n');
            const signatures = [];

            for (let line of lines) {
                if (line.includes('Unstable Wormhole') || line.includes('Cosmic Signature')) {
                    // Extract the signature code (e.g., "NLC-815")
                    const parts = line.trim().split(/\s+/);
                    if (parts.length > 0) {
                        const isCosmicSignature = line.includes('Cosmic Signature');
                        const isUnstableWormhole = line.includes('Unstable Wormhole');
                        signatures.push({
                            code: parts[0].substring(0, 3),
                            isCosmicSignature: isCosmicSignature,
                            isUnstableWormhole: isUnstableWormhole
                        });
                    }
                }
            }

            // Filter out cosmic signatures if checkbox is unchecked
            const includeCosmicSignatures = document.getElementById('includeCosmicSignatures').checked;
            const filteredSignatures = includeCosmicSignatures
                ? signatures
                : signatures.filter(sig => !sig.isCosmicSignature);

            // Sort signatures
            filteredSignatures.sort((a, b) => a.code.localeCompare(b.code));

            // Generate bookmarks
            filteredSignatures.forEach((sig, i) => {
                const signature = sig.code.substring(0, 3);
                const isCosmicSignature = sig.isCosmicSignature;
                const isUnstableWormhole = sig.isUnstableWormhole;

                // Generate bookmark based on current form state
                let bookmarkText;
                if (isHome()) {
                    bookmarkText = ` ${nextHole || ''} ${signature} ${code}`.toUpperCase();
                } else {
                    const currentHoleLetter = currentHole ? currentHole.charAt(0) : '';
                    const depthString = getAllDepths().join('');
                    bookmarkText = ` ${currentHoleLetter}${depthString === '0' ? '' : depthString}-${i + 1} ${signature} `.toUpperCase();
                }

                // Add bookmark to the list
                if (bookmarkText.trim()) {
                    addBookmark(bookmarkText, isCosmicSignature, isUnstableWormhole);
                }
            });
        }

        let depthCounter = 1;

        function addDepth() {
            const depthContainer = document.getElementById('depthContainer');
            const newSelect = document.createElement('select');
            newSelect.className = 'depth-field';
            newSelect.id = 'currentDepth' + depthCounter;

            // Populate with 1-100
            for (let i = 1; i <= 100; i++) {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = i;
                newSelect.appendChild(option);
            }
            newSelect.value = '1';

            // Add event listener
            newSelect.addEventListener('change', function() {
                generateString();
                generateBookmarksFromSignatures();
            });

            depthContainer.appendChild(newSelect);
            depthCounter++;
            updateRemoveDepthButton();
            generateString();
            generateBookmarksFromSignatures();
        }

        function removeDepth() {
            const depthContainer = document.getElementById('depthContainer');
            const depthFields = depthContainer.querySelectorAll('.depth-field');

            // Only remove if there's more than one depth field
            if (depthFields.length > 1) {
                // Remove the last depth field
                depthFields[depthFields.length - 1].remove();
                updateRemoveDepthButton();
                generateString();
                generateBookmarksFromSignatures();
            }
        }

        function updateRemoveDepthButton() {
            const depthContainer = document.getElementById('depthContainer');
            const depthFields = depthContainer.querySelectorAll('.depth-field');
            const removeButton = document.getElementById('removeDepthButton');
            const addButton = document.getElementById('addDepthButton');

            // Disable remove button if only one depth field left
            removeButton.disabled = depthFields.length <= 1;

            // Disable add button if current depth is 0
            const currentDepth = document.getElementById('currentDepth');
            addButton.disabled = currentDepth && currentDepth.value === '0';
        }

        function getAllDepths() {
            const depthFields = document.querySelectorAll('.depth-field');
            const depths = [];
            depthFields.forEach(field => {
                const value = field.value;
                if (value) {
                    depths.push(value);
                }
            });
            return depths;
        }

        function clearExtraDepths() {
            const depthContainer = document.getElementById('depthContainer');
            const depthFields = depthContainer.querySelectorAll('.depth-field');
            // Remove all but the first depth field
            for (let i = 1; i < depthFields.length; i++) {
                depthFields[i].remove();
            }
            depthCounter = 1;
            updateRemoveDepthButton();
        }

        function makeCurrentFromNext() {
            const nextHole = document.getElementById('nextHole').value;
            if (nextHole) {
                document.getElementById('currentHole').value = nextHole;
                document.getElementById('signature').value = '';
                document.getElementById('code').value = '';
                clearExtraDepths();
                generateString();
                generateBookmarksFromSignatures();
            }
        }

        function goToNext() {
            const nextDepthSelect = document.getElementById('nextDepth');
            const currentNextDepth = parseInt(nextDepthSelect.value) || 0;
            const newDepth = currentNextDepth + 1;

            if (newDepth <= 100) {
                nextDepthSelect.value = newDepth.toString();
            }

            document.getElementById('signature').value = '';

            generateString();
            generateBookmarksFromSignatures();
        }

        function resetDepth() {
            const nextDepthSelect = document.getElementById('nextDepth');
            nextDepthSelect.value = '1';
            generateString();
            generateBookmarksFromSignatures();
        }

        function copyToClipboard(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text).then(function() {
                const message = document.getElementById('copiedMessage');
                message.style.display = 'block';
                setTimeout(function() {
                    message.style.display = 'none';
                }, 2000);
            }).catch(function(err) {
                alert('Failed to copy: ' + err);
            });
        }

        // Bookmarks list management
        let bookmarkCounter = 0;

        function addBookmark(bookmarkText, isCosmicSignature = false, isUnstableWormhole = false) {
            if (!bookmarkText || bookmarkText.trim() === '') return;

            const copyIcon = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
            `;

            const bookmarksList = document.getElementById('bookmarksList');
            const bookmarkItem = document.createElement('div');
            bookmarkItem.className = 'bookmark-item';
            bookmarkItem.id = 'bookmark-' + bookmarkCounter;

            // Apply light yellow background for Cosmic Signatures
            if (isCosmicSignature) {
                if (isDarkMode()) {
                    bookmarkItem.style.backgroundColor = '#ba8e23';
                } else {
                    bookmarkItem.style.backgroundColor = '#ffffc5';
                }
            }
            // Apply light green background for Unstable Wormholes
            else if (isUnstableWormhole) {
                if (isDarkMode()) {
                    bookmarkItem.style.backgroundColor = '#06402b';
                } else {
                    bookmarkItem.style.backgroundColor = '#d4edda';
                }
            }

            const bookmarkTextSpan = document.createElement('span');
            bookmarkTextSpan.className = 'bookmark-text';
            bookmarkTextSpan.textContent = bookmarkText;
            bookmarkTextSpan.id = 'bookmark-text-' + bookmarkCounter;
            bookmarkTextSpan.onclick = () => copyToClipboard(bookmarkTextSpan.id);

            const copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.onclick = () => copyToClipboard(bookmarkTextSpan.id);
            copyButton.innerHTML = copyIcon;

            bookmarkItem.appendChild(bookmarkTextSpan);
            bookmarkItem.appendChild(copyButton);
            bookmarksList.appendChild(bookmarkItem);

            // Extract temporary name (first part before space, without dash)
            const tempName = bookmarkText.trim().split(' ')[0].replace('-', '');
            addTempName(tempName, isCosmicSignature, isUnstableWormhole);

            bookmarkCounter++;
        }

        function addTempName(tempNameText, isCosmicSignature = false, isUnstableWormhole = false) {
            if (!tempNameText || tempNameText.trim() === '') return;

            const copyIcon = `
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"></rect>
                    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"></path>
                </svg>
            `;

            const tempNamesList = document.getElementById('tempNamesList');
            const tempNameItem = document.createElement('div');
            tempNameItem.className = 'temp-name-item';
            tempNameItem.id = 'temp-name-' + bookmarkCounter;

                        // Apply light yellow background for Cosmic Signatures
            if (isCosmicSignature) {
                if (isDarkMode()) {
                    tempNameItem.style.backgroundColor = '#ba8e23';
                } else {
                    tempNameItem.style.backgroundColor = '#ffffc5';
                }
            }
            // Apply light green background for Unstable Wormholes
            else if (isUnstableWormhole) {
                if (isDarkMode()) {
                    tempNameItem.style.backgroundColor = '#06402b';
                } else {
                    tempNameItem.style.backgroundColor = '#d4edda';
                }
            }

            const tempNameTextSpan = document.createElement('span');
            tempNameTextSpan.className = 'temp-name-text';
            tempNameTextSpan.textContent = tempNameText;
            tempNameTextSpan.id = 'temp-name-text-' + bookmarkCounter;
            tempNameTextSpan.onclick = () => copyToClipboard(tempNameTextSpan.id);

            const copyButton = document.createElement('button');
            copyButton.className = 'copy-button';
            copyButton.onclick = () => copyToClipboard(tempNameTextSpan.id);
            copyButton.innerHTML = copyIcon;

            tempNameItem.appendChild(tempNameTextSpan);
            tempNameItem.appendChild(copyButton);
            tempNamesList.appendChild(tempNameItem);
        }

        function clearBookmarks() {
            const bookmarksList = document.getElementById('bookmarksList');
            bookmarksList.innerHTML = '';
            const tempNamesList = document.getElementById('tempNamesList');
            tempNamesList.innerHTML = '';
            bookmarkCounter = 0;
        }

        // Settings management functions
        function saveSettings() {
            const settings = {
                signatureMode: document.querySelector('input[name="signatureMode"]:checked').value,
                includeCosmicSignatures: document.getElementById('includeCosmicSignatures').checked,
                grandmaMode: document.getElementById('grandmaModeToggle').checked
            };
            localStorage.setItem('vaporLockSettings', JSON.stringify(settings));

            generateBookmarksFromSignatures();
        }

        function loadSettings() {
            const savedSettings = localStorage.getItem('vaporLockSettings');
            if (!savedSettings) return;

            try {
                const settings = JSON.parse(savedSettings);

                // Load signature mode
                if (settings.signatureMode) {
                    document.getElementById(settings.signatureMode === 'single' ? 'singleSignature' : 'allSignatures').checked = true;
                }

                // Load include cosmic signatures
                if (settings.includeCosmicSignatures !== undefined) {
                    document.getElementById('includeCosmicSignatures').checked = settings.includeCosmicSignatures;
                }

                // Load grandma mode
                if (settings.grandmaMode !== undefined) {
                    document.getElementById('grandmaModeToggle').checked = settings.grandmaMode;
                }
            } catch (e) {
                console.error('Failed to load settings:', e);
            }
        }

        // Initialize
        loadSettings();
        populateHoleDropdowns();
        toggleSignatureMode();
        generateString();
        generateBookmarksFromSignatures();
    </script>
</body>
</html>
